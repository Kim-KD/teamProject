<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="boardBean">
	
	<!-- 게스트 하우스 게시글 총 갯수 -->
	<select id='ghCount' resultType='int'>
		select /*+ index_ffs(gh_info pk_gh_num)*/ count(*)
		from gh_info
	</select>
	
	<!-- 관광 명소 게시글 총 갯수 -->
	<select id='tripCount' resultType='int'>
		select /*+ index_ffs(trip_info pk_trip_num)*/ count(*)
		from trip_info
	</select>
	
	<!-- 게스트 하우스 게시글 정보 -->
	<select id="ghFindAll" resultType="board">
	<![CDATA[
		select*from
			(select gh.*,rownum as rnum from
				(select /*+ index_desc(gh_info gh_pk_no)*/ 
				no,user_id userId,title,content,w_date wDate,city,postcode,
				address,on_off onOff,p_link pLink,up_view upView,views,likes
				from gh_info)gh
			where rownum<=#{endRowNum})
		where rnum>=#{startRowNum}
	]]>
	</select>
	
 		<!-- 관광 명소 게시글 정보 -->
	<select id="tripFindAll" resultType="board">
	<![CDATA[
	 		select*from
	 			(select trip.*,rownum as rnum from
	 				(select /*+ index_desc(trip_info trip_pk_no)*/
	 				no,user_id userId,title,content,admission,opentime,w_date wDate,
	 				city,postcode,address,on_off onOff,p_link pLink,up_view upView,views,likes
	 				from trip_info)trip
	 			where rownum<=#{endRowNum})
	 		where rnum>=#{startRowNum}
	 	]]>
	</select>
	
	 	<!-- 게스트하우스 조회수 상승 -->
	<update id="ghReadCnt">
		update gh_info set views=views+1
		where no=#{no} and rownum=1
	</update>
	
	 	<!-- 관광명소 조회수 상승 -->
	<update id="tripReadCnt">
		update trip_info set views=views+1
		where no=#{no} and rownum=1
	</update>
	
		<!-- 게스트하우스 글번호 찾기 -->
	 <select id="ghFindById" resultType="board">
		select no,user_id userId,title,content,w_date wDate,city,postcode,
		address,on_off onOff,p_link pLink,up_view upView,views,likes
		from gh_info
		where no=#{no}
	</select>
	
		<!-- 관광명소 글번호 찾기 -->
	 <select id="tripFindById" resultType="board">
		no,user_id userId,title,content,admission,opentime,w_date wDate,
	 	city,postcode,address,on_off onOff,p_link pLink,up_view upView,views,likes
	 	from trip_info
		where no=#{no}
	</select>
	 	
	 	<!-- 게스트하우스 게시글 작성 -->
	<insert id="ghInsert" parameterType="board">
		<selectKey resultType="int" keyProperty="bno" order="BEFORE">
			select gh_seq.nextval from dual
		</selectKey>
		insert into gh_info(no,user_id userId,title,content,w_date wDate,city,postcode,
				address,on_off onOff,p_link pLink,up_view upView,views,likes)
		values(#{no},#{userId},#{title},#{content},sysdate,#{city},#{postcode},#{address},
		y,n,n,0,0)
	</insert>
	
	 	<!-- 관광명소 게시글 작성 -->
	<insert id="trupInsert" parameterType="board">
		<selectKey resultType="int" keyProperty="bno" order="BEFORE">
			select trip_seq.nextval from dual
		</selectKey>
		insert into trip_info(no,user_id userId,title,content,admission,opentime,
		w_date wDate,city,postcode,address,on_off onOff,p_link pLink,up_view upView,views,likes)
		values(#{no},#{userId},#{title},#{content},#{admission},#{opentime},sysdate,
		#{city},#{postcode},#{address},y,n,n,0,0)
	</insert>


	 	<!-- 게스트하우스 게시글 수정 -->
	<update id="ghUpdate">
		update gh_info
		 <trim prefix="SET" suffixOverrides=",">
			<if test="title != null">title = #{title},</if>
			<if test="content != null">content = #{content},</if>
			<if test="city != null">city = #{city},</if>
			<if test="address != null">city = #{address},</if>
			<if test="postcode != null">postcode = #{postcode},</if>
			<if test="onOff != null">on_off = #{onOff},</if>
			<if test="pLink != null">p_link = #{pLink},</if>
			<if test="upView != null">up_view = #{upView},</if>
			<if test="views > 0">views = views+1,</if>
			<if test="likes > 0">likes = likes+1,</if>
		</trim>
		where no=#{no} and rownum=1
	</update>

	
	 	<!-- 관광명소 게시글 수정 -->
	<update id="tripUpdate">
		update trip_info
		 <trim prefix="SET" suffixOverrides=",">
			<if test="title != null">title = #{title},</if>
			<if test="content != null">content = #{content},</if>
			<if test="admission != null">admission = #{admission},</if>
			<if test="opentime != null">opentime = #{opentime},</if>
			<if test="city != null">city = #{city},</if>
			<if test="address != null">city = #{address},</if>
			<if test="postcode != null">postcode = #{postcode},</if>
			<if test="onOff != null">on_off = #{onOff},</if>
			<if test="pLink != null">p_link = #{pLink},</if>
			<if test="upView != null">up_view = #{upView},</if>
			<if test="views > 0">views = views+1,</if>
			<if test="likes > 0">likes = likes+1,</if>
		</trim>
		where no=#{no} and rownum=1
	</update>
	
	 	<!-- 게스트하우스 게시글 삭제 -->
	<delete id="ghDelete">
		delete from gh_info where no=#{no} and rownum=1
	</delete>
	
	 	<!-- 관광명소 게시글 삭제 -->
	<delete id="tripDelete">
		delete from trip_info where no=#{no} and rownum=1
	</delete>
	
</mapper>